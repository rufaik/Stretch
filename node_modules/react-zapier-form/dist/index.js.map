{"version":3,"sources":["../src/index.js"],"names":["ZapierForm","props","state","error","loading","success","onSubmit","bind","onSuccess","onError","e","preventDefault","canSubmit","honeypot","value","setState","data","FormData","form","validate","notValid","res","body","action","method","status","statusText","json","err","console","formProps","display","honeyPotName","children","React","Component","defaultProps","noop"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;;;IAEMA,U;;;AACL,qBAAYC,KAAZ,EAAmB;AAAA;;AAAA,oIACZA,KADY;;AAElB,QAAKC,KAAL,GAAa;AACZC,UAAO,KADK;AAEZC,YAAS,KAFG;AAGZC,YAAS;AAHG,GAAb;AAKA,QAAKC,QAAL,GAAgB,MAAKA,QAAL,CAAcC,IAAd,OAAhB;AACA,QAAKC,SAAL,GAAiB,MAAKA,SAAL,CAAeD,IAAf,OAAjB;AACA,QAAKE,OAAL,GAAe,MAAKA,OAAL,CAAaF,IAAb,OAAf;AATkB;AAUlB;;;;;wGACcG,C;;;;;;AACdA,UAAEC,cAAF;;cACI,CAAC,KAAKV,KAAL,CAAWW,SAAZ,IAAyB,KAAKC,QAAL,CAAcC,K;;;;;;;;;AAE3C,aAAKC,QAAL,CAAc;AACbX,kBAAS,IADI;AAEbD,gBAAO,KAFM;AAGbE,kBAAS;AAHI,SAAd;;AAMIW,Y,GAAO,IAAIC,QAAJ,CAAa,KAAKC,IAAlB,C;;eAEU,KAAKjB,KAAL,CAAWkB,QAAX,CAAoBH,IAApB,C;;;AAAjBI,gB;;aACAA,Q;;;;;yCACI,KAAKL,QAAL,CAAc;AACpBX,kBAAS,KADW;AAEpBD,gBAAO,KAFa;AAGpBE,kBAAS;AAHW,SAAd,C;;;;AAOR,aAAKJ,KAAL,CAAWK,QAAX,CAAoBU,IAApB;;AAEIK,W;AACAC,Y;;;eAES,+BAAM,KAAKrB,KAAL,CAAWsB,MAAjB,EAAyB;AACpCC,uBADoC;AAEpCF,eAAMN;AAF8B,SAAzB,C;;;AAAZK,W;;;;;;;yCAMO,KAAKZ,OAAL,oB;;;cAEJY,IAAII,MAAJ,KAAe,G;;;;;yCACX,KAAKhB,OAAL,iBAA2BY,IAAIK,UAA/B,C;;;;;eAGML,IAAIM,IAAJ,E;;;AAAbL,Y;;;;;;;yCAGO,KAAKb,OAAL,sB;;;cAELa,KAAKG,MAAL,c;;;;;yCACK,KAAKhB,OAAL,CAAaa,IAAb,C;;;AAER,aAAKd,SAAL,CAAea,GAAf;;;;;;;;;;;;;;;;;;4BAESC,I,EAAM;AACf,QAAKrB,KAAL,CAAWO,SAAX,CAAqBc,IAArB;AACA,QAAKP,QAAL,CAAc;AACbX,aAAS,KADI;AAEbC,aAASiB,IAFI;AAGbnB,WAAO;AAHM,IAAd;AAKA;;;0BACOyB,G,EAAK;AACZC,WAAQ1B,KAAR,CAAcyB,GAAd;AACA,QAAK3B,KAAL,CAAWQ,OAAX,CAAmBmB,GAAnB;AACA,UAAO,KAAKb,QAAL,CAAc;AACpBX,aAAS,KADW;AAEpBD,WAAOyB,GAFa;AAGpBvB,aAAS;AAHW,IAAd,CAAP;AAKA;;;2BACQ;AAAA;;AACR,UACC;AAAA;AAAA;AACC,UAAK;AAAA,aAAQ,OAAKa,IAAL,GAAYA,IAApB;AAAA,MADN;AAEC,eAAU,KAAKZ;AAFhB,OAGK,KAAKwB,SAHV;AAKC;AAAA;AAAA,OAAK,OAAO,EAAEC,eAAF,EAAZ;AACC;AACC,YAAK,MADN;AAEC,YAAM,KAAK9B,KAAL,CAAW+B,YAFlB;AAGC,WAAK;AAAA,cAAY,OAAKnB,QAAL,GAAgBA,QAA5B;AAAA;AAHN;AADD,KALD;AAYE,SAAKZ,KAAL,CAAWgC,QAAX,CAAoB,KAAK/B,KAAzB;AAZF,IADD;AAgBA;;;EA9FuBgC,gBAAMC,S;;AAiG/BnC,WAAWoC,YAAX,GAA0B;AACzBxB,YAAW,IADc;AAEzBoB,yBAFyB;AAGzB1B,WAAU+B,cAHe;AAIzB7B,YAAW6B,cAJc;AAKzB5B,UAAS4B,cALgB;AAMzBlB,WAAUkB;AANe,CAA1B;;kBASerC,U","file":"index.js","sourcesContent":["import React from 'react'\nimport fetch from 'isomorphic-fetch'\n\nimport noop from './noop'\n\nclass ZapierForm extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\t\tthis.state = {\n\t\t\terror: false,\n\t\t\tloading: false,\n\t\t\tsuccess: false,\n\t\t}\n\t\tthis.onSubmit = this.onSubmit.bind(this)\n\t\tthis.onSuccess = this.onSuccess.bind(this)\n\t\tthis.onError = this.onError.bind(this)\n\t}\n\tasync onSubmit(e) {\n\t\te.preventDefault()\n\t\tif (!this.props.canSubmit || this.honeypot.value) return\n\n\t\tthis.setState({\n\t\t\tloading: true,\n\t\t\terror: false,\n\t\t\tsuccess: false,\n\t\t})\n\n\t\tlet data = new FormData(this.form)\n\n\t\tlet notValid = await this.props.validate(data)\n\t\tif (notValid) {\n\t\t\treturn this.setState({\n\t\t\t\tloading: false,\n\t\t\t\terror: false,\n\t\t\t\tsuccess: false,\n\t\t\t})\n\t\t}\n\n\t\tthis.props.onSubmit(data)\n\n\t\tlet res\n\t\tlet body\n\t\ttry {\n\t\t\tres = await fetch(this.props.action, {\n\t\t\t\tmethod: `post`,\n\t\t\t\tbody: data,\n\t\t\t})\n\t\t}\n\t\tcatch(err){\n\t\t\treturn this.onError(`Connection error`)\n\t\t}\n\t\tif (res.status !== 200) {\n\t\t\treturn this.onError(`Error code ${res.statusText}`)\n\t\t}\n\t\ttry{\n\t\t\tbody = await res.json()\n\t\t}\n\t\tcatch(err){\n\t\t\treturn this.onError(`Error parsing JSON`)\n\t\t}\n\t\tif(body.status !== `success`){\n\t\t\treturn this.onError(body)\n\t\t}\n\t\tthis.onSuccess(res)\n\t}\n\tonSuccess(body) {\n\t\tthis.props.onSuccess(body)\n\t\tthis.setState({\n\t\t\tloading: false,\n\t\t\tsuccess: body,\n\t\t\terror: false,\n\t\t})\n\t}\n\tonError(err) {\n\t\tconsole.error(err)\n\t\tthis.props.onError(err)\n\t\treturn this.setState({\n\t\t\tloading: false,\n\t\t\terror: err,\n\t\t\tsuccess: false,\n\t\t})\n\t}\n\trender() {\n\t\treturn (\n\t\t\t<form\n\t\t\t\tref={form => this.form = form}\n\t\t\t\tonSubmit={this.onSubmit}\n\t\t\t\t{...this.formProps}\n\t\t\t\t>\n\t\t\t\t<div style={{ display: `none` }}>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype='text'\n\t\t\t\t\t\tname={this.props.honeyPotName}\n\t\t\t\t\t\tref={honeypot => this.honeypot = honeypot}\n\t\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t{this.props.children(this.state)}\n\t\t\t</form>\n\t\t)\n\t}\n}\n\nZapierForm.defaultProps = {\n\tcanSubmit: true,\n\thoneyPotName: `p_number`,\n\tonSubmit: noop,\n\tonSuccess: noop,\n\tonError: noop,\n\tvalidate: noop,\n}\n\nexport default ZapierForm"]}